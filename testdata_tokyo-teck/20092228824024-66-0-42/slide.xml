<presentation language="ja">
<slide page="1">
<body>
<p>
知的画像処理（１１） 1
MAP-MRFに基づく画像処理
</p>
</body>
</slide>
<slide page="2">
<body>
<p>
知的画像処理（１１） 2
Low Level 処理でよくMRFモデルを利用．
•画像の復元・再構成
•エッジ検出
•テクスチャ分割、ディスパリティ検出
•動的輪郭モデル・オプティカルフローなど
低次レベル（早期）画像処理
</p>
</body>
</slide>
<slide page="3">
<body>
<p>
知的画像処理（１１） 3
画素値の配列観測 :},,,,{ 21 Ddddd im ∈= Ld
受けたもの　　変換と画質劣化を
がにおける真の値 fd MRF:
),0()()( 2iiiii Neefd σϕϕ ≈+= は線形変換、　；
線形変換、ガウス性雑音に単純化
　となる．　　
　　
)2/())(()(
,
2
1)(
22
)(
2
ii
Si
i
U
i
m
i
dfU
ep
σϕ
πσ
−=
∏
=
∑
∈
−
f|d
f|d f|d
画像の尤度情報（観測モデル）
</p>
</body>
</slide>
<slide page="4">
<body>
<p>
知的画像処理（１１） 4
⎩⎨
⎧
<−= )0(;
;0)(
cc
c
CV ξξ それ以外
ラベルの全てのサイトが同一f
のときのラベルが lffV ili ,)(1 α=
)](1[),()( 202 jijic ffvffVV −−== δf
ポテンシャル複数サイトクリークの•
特にペアサイトの場合
ポテンシャル単一サイトのクリーク•
面の事前情報（区分的一定面）
は，ギーした場合の事前エネルペアサイトのみを考慮 )( fU
∑ ∑
∈ ∈
−−=
Si Nj
ji
i
ffvU )](1[)( 20 δf
</p>
</body>
</slide>
<slide page="5">
<body>
<p>
知的画像処理（１１） 5
を利用．
ークポテンシャルのみ通常，ペアサイトクリ
ijiji NjffgffV
す以下の条件が必要．区分的な滑らかさを表
次．さらに、通常はペナルティ関数で、 2)(⋅g
は正の定数
例として，
ααηη },,min{)( 2=g
∈−= ),(),(2
∞<=∞→ Dg |)('|lim ηη
面の事前情報（区分的連続面）
</p>
</body>
</slide>
<slide page="6">
<body>
<p>
知的画像処理（１１） 6
を最小化する．事後エネルギー
の枠組みでは、最適な
)(
MRF-MAP
d|f
f
U
を計算．を最小化する５．
を導出．ー　　から事後エネルギ
と尤度エネルギー４．事前エネルギー
　　
雑音のガウス分布に基づく　　互いに独立で同一
度エネルギーの導出．３．観測モデルから尤
テンシャルの定義．分布の事前クリークポ２．
リーク集合の定義．１．隣接システムとク
*
22
)()(
)(
)()(
)2/()()(
Gibbs
fd|ff
d|f
f|df
f|d
UE
U
UU
dfU i
Si
i
=
−=∑
∈
σ
手順
画像復元問題（区分的一定面）
</p>
</body>
</slide>
<slide page="7">
<body>
<p>
知的画像処理（１１） 7
))(1()2/()(
)()()()(
20
22
j
Si Nj
ii
Si
i ffvdf
UUUE
i
−−+−=
+⇐=
∑∑∑
∈ ∈∈
δσ
ff|dd|ff
：最適復元画像最小解　 *f
くなるまで繰り返す．エネルギーが減少しな
を局所的に最小化．
に対し、の新しいラベルト任意のサイ
法の例）初期配置：（
)()(
Greedy
)()1(
)1(
0
tt
d
t
i
EE
Lfi
F
ff
f
−
∈
∈
+
+
法など．　
法，下法，　最適化手法：最急降
)nPropagatioBelief(BP
greedy
組合せ最適化問題ラベル集合：離散的⇒
</p>
</body>
</slide>
<slide page="8">
<body>
<p>
知的画像処理（１１） 8
}),min{)((
)(
2 αηη
η
=g
g
：２次のペナルティ関数　　
ポテンシャル：　ペアサイトクリーク
ポテンシャル：除外，　単一サイトクリーク
ンシャルの定義．２．事前クリークポテ
義．そのクリーク集合の定１．隣接システムと、
)2/()()(
),0((
22
2
σ
σ
i
Si
i dfU
Ne
−=
≈
∑
∈
f|d
として）定義．３．尤度エネルギーの
区分的に連続な画像復元では、Lは連続な値をとる
手順
画像復元問題（区分的連続面）
</p>
</body>
</slide>
<slide page="9">
<body>
<p>
知的画像処理（１１） 9
22 2,)()()( σλλ =−+−= ∑ ∑∑
∈ ∈∈
j
Si Nj
ii
Si
i ffgdfE
i
f
れる．的に次式のように表さ事後エネルギーは等価
)()()(
)}1,(),1,(),,1(),,1{(
},1|),{(
,
, ),(
,
2
,
,
,
),(
),(
lk
ji Nlk
jiji
ji
ji
ji
ffgdfE
jijijijiN
njijiS
ji
−+−=
+−+−=
≤≤=
∑ ∑∑
∈
λf
ギーは，とすると，事後エネル
，２次元の場合，
)()2/()(
)()(
22
j
Si Nj
ii
Si
i ffgdf
UE
i
−+−=
=
∑∑∑
∈ ∈∈
σ
d|ff
計算．４．事後エネルギーの
</p>
</body>
</slide>
<slide page="10">
<body>
<p>
知的画像処理（１１）10
面の復元の一種であるが，疎なデータを対象と
し、復元と補間の処理から成る．
（例）ステレオ視からの面の再構成．
は真の奥行値．確率分布．
ガウス性のは互いに独立で同一のと仮定．誤差
とき、観測モデルをにおける奥行値を表す
が．：有効な奥行値の集合
),(
),(),(
),(
),(}|{
ii
i
iiiii
ii
iiii
yxf
e
eyxfyxd
yx
yxddAid
+=
=∈=d
奥行値の観測モデル
面の再構成問題
</p>
</body>
</slide>
<slide page="11">
<body>
<p>
知的画像処理（１１）11
この項の例は，正則化法(Regularization)における
正則化項に相当．
不良設定問題の良設定化．
)( fU事前エネルギー：
関数を含む必要あり．　２次あるいは高次導
かさの項を付与．事前情報として，滑ら
⇒
dxdyyxfyxfyxfU yyxyxx }),(),(),({)(
222 ++= ∫f
らかさの項の例２次導関数からなる滑
</p>
</body>
</slide>
<slide page="12">
<body>
<p>
知的画像処理（１１）12
2
1,,1,
2
1,11,,1,
2
,1,,1
]2[
][2
]2[)(
−+
−−−−
−+
+−
++−−
++−=
∑∑
∑∑
∑∑
jiji
i j
ji
jijiji
i j
ji
jiji
i j
ji
fff
ffff
fffU f
となる．ような事前エネルギー
の差分近似によって以下離散形では、導関数の
)()2/()(
)()(
22 f
d|ff
Udf
UE
i
Si
i +−=
=
∑
∈
σ
事後エネルギーは、
解．がを最小化する事後エネルギー MAP)( *ffU
</p>
</body>
</slide>
<slide page="13">
<body>
<p>
知的画像処理（１１）13
など．や
象．スチャ性のエッジが対濃度変化による非テク
edge roofedge jump
ル化）状サイト，観測のモデ影響を受ける．（格子
雑音のれており、画素の値は画素の配置は量子化さ
作成．のラベリングモデルを
デルを参考に、エッジ区分的に連続な復元モ
題．や再構成に類似した問エッジ検出は画像復元
エッジ検出問題
</p>
</body>
</slide>
<slide page="14">
<body>
<p>
知的画像処理（１１）14
ークを可能とする．を修正してエッジのマ
である．は、と表す．関数
事後エネルギーを
)(
|)(|lim
)()()(
'
2
⋅
∞<=
−+−=
∞→
∈ ∈∈
∑ ∑∑
g
Cgg
ffgdfE j
Si Nj
ii
Si
i
i
η
λ
η
f
モデルを考える．互いに結合した２つのMRF
のいずれか．を示し，　ラベルはエッジの生起
ラインプロセス
モデルを導入．もう１つの
{0,1}
process) (line
MRF
</p>
</body>
</slide>
<slide page="15">
<body>
<p>
知的画像処理（１１）15
右図の結合MRF
・濃淡値に対する既存格子
・エッジ場に対する双対格子
（隣接画素間のエッジ）
．が隣接することを示すとは、と表現．
双対な格子サイト：
画素の格子サイト：
jiji
jiSjijiS
miiSm
PE
P
<>
<>
L
};,|),{(
},1|{
∈=
==
１）とする．をエッジラベル（０か
を濃淡ラベル、
,),(,
,,
,
EE
ji
PP
i
Sjif
Sif
∈
∈
</p>
</body>
</slide>
<slide page="16">
<body>
<p>
知的画像処理（１１）16
で表される．
ギー、あるいは事前エネル結合確率
の結合：２つの
),(
),(
MRF
EP
EP
U
P
ff
ff
)(
},)min{()( 2
i
P
j
P
i
P
j
P
i
Nj
ffffg
∈
−=−
変数の関数に修正．を、濃淡変数とエッジ
ポテンシャル関数 α
jifffffffg Eji
E
ji
P
j
P
i
E
ji
P
j
P
i <>,)1()(),,( ,,2, α+−−=
∑ ∑∑ ∑
∑ ∑
∈ ∈∈ ∈
∈ ∈
+=
=
P
i
P
i
P
i
Si Nj
E
ji
Si Nj
E
ji
P
j
P
i
Si Nj
E
ji
P
j
P
i
EP
EP
fVfffV
fffgU
U
)()|,(
),,(),(
),(
,,
,ff
ff は、事前エネルギー
</p>
</body>
</slide>
<slide page="17">
<body>
<p>
知的画像処理（１１）17
∑∑∑
∈ ∈∈
+−=
P
i
P Si Nj
E
ji
P
j
P
i
Si
i
P
i
EP
EP
fffgdfU
U
),,()()|,(
)|,(
,
2 λdff
dff は、ー従って､事後エネルギ
組合せ問題）は実数での最小化．は離散，
が対象．との上式の最小化：すべて
(PE
EP
ff
ff
⎪⎩
⎪⎨⎧ >−=
−+−= ∑∑∑
∈ ∈∈
それ以外
もし
決定．を閾値処理することでは，エッジ場
の取得が可能．復元画像に関する最小化だけで
．化問題への変換も可能より単純な実数値最小
0
)(1
)(
)(
)()()(
2
,
*
*
2
α
λ
P
j
P
iE
ji
PE
PP
Si Nj
P
j
P
i
Si
i
P
i
P
ff
f
ffgdfE
i
ff
ff
f
</p>
</body>
</slide>
<slide page="18">
<body>
<p>
知的画像処理（１１）18
禁止エッジパターンが存在する場合
1
0 11
1 1
1 10 1 0
0
0
1
1 11
1
孤立エッジ 鋭角エッジ 4接合エッジ 構造エッジ
(例）
問題．拘束条件下での最小化という拘束条件．
ないは，禁止エッジ配置がここで，：
⇒
=
=
=
0)(
),(minarg)*,*(
0)(:),(
EE
EP
fUff
EP
U
E
EEEP
f
ffff
この場合のMAPエッジ検出問題は、
ペナルティ法による最小化
</p>
</body>
</slide>
<slide page="19">
<body>
<p>
知的画像処理（１１）19
局所的な禁止配置は無限に大きなクリーク
ポテンシャルによるペナルティで実現可能
様．直エッジについても同ティが課せられる．垂
が共に１のときペナルのように表現可能．
ペナルティとしてはこのとき、水平方向の
の１つの値をとる．としてに分類．
と水平エッジ場を垂直エッジ場
jiji
ji
E
jijiji
E
hh
fSji
hvff
,1,
,
,,,
,
}1,0{,),(
}{}{}{
+
∈
=
0,)(
),(
,1, >=
(例）隣り合う平行な2本のエッジの禁止
∑ + h
ji
jijihh hhhU λλ
jih ,
jih ,1+
</p>
</body>
</slide>
<slide page="20">
<body>
<p>
知的画像処理（１１）20
MRFテクスチャ解析における3項目
・テクスチャモデル(Texture Modeling)
・テクスチャ分類(Texture Classification)
・テクスチャ分割(Texture Segmentation)
テクスチャ解析問題
</p>
</body>
</slide>
<slide page="21">
<body>
<p>
知的画像処理（１１）21
など．，　
モデルの例・
LL)Logistic(M Level-MultiNormal-Auto
MRF
ル関数で定義．のクリークポテンシャ
の確率をパターンモデルではテクスチャ
例えば、
MLLMLL f
・１つのテクスチャ：１つのMRFモデル．
・複数テクスチャ画像：複数のMRFモデルを
階層的に使用．
MRFテクスチャモデル
</p>
</body>
</slide>
<slide page="22">
<body>
<p>
知的画像処理（１１）22
⎩⎨
⎧
−
∈= それ以外
のサイトが同一ラベル
ないとき、テンシャルのみが０で（例）ペアクリークポ
が存在．は、１０個のクリーク２次の隣接システムで
c
c
ji
Cji
ffV β
β 2
2
},{
),(
),()(,1)(
),(
MRFMLL
2
)(
2
j
Si Nj
i
U
jii
ffVUe
Z
P
ffV
i
∑ ∑
∈ ∈
− ==
⇒
ff f
の確定．　　の決定各
のモデル化：による
β
を求めることは困難．の確率く，直接的に配置
を決定することは難し規化係数）実際は、分配関数（正
)( ff P
Z
．によるテクスチャ生成MCMC
</p>
</body>
</slide>
<slide page="23">
<body>
<p>
知的画像処理（１１）23
Gibbs Sampler
S
i LfLff ∈∈ , Step1. の初期化
に設定．　の確率でラベルを　
の計算．　
lpf
LlflfPp
Si
li
Nil i
        2)-2   
    allfor    )|(    )1-2   
do for   Step2.
∈==
∈
回繰り返す．を NStep2 Step3.
条件付生起確率：Gibbs分布から計算
ルーレット選択によるラベル決定
∑ ∑
∑
∈ ∈
∈==
Lf Ni
ii
Ni
ii
Ni
i i
i
i ffV
ffV
flfP
}),(exp{
}),(exp{
)|(
'
'2
'
'2
</p>
</body>
</slide>
<slide page="24">
<body>
<p>
知的画像処理（１１）24
A
B
C
)25.0(
)45.0(
)30.0(
ルーレット選択とは
)1,0(]1,0[ Uの一様乱数生成器　：
⎪⎩
⎪⎨
⎧
≤<
≤<
≤≤
=
=
00.170.0
70.025.0
25.00
),,1()1,0(
i
i
i
i
i
uifc
uifb
uifa
X
NiuU
値を決める。
に対して以下のようにで発生させた乱数 L
C
B
A
25.0
70.0
00.0
00.1
</p>
</body>
</slide>
<slide page="25">
<body>
<p>
知的画像処理（１１）25
Metropolis Sampler
S
i LfLff ∈∈ , Step1. の初期化
とする．　をの確率で
の計算．　
で置換した配置　をランダムに
'   3)-2   
)}(/)'(,1min{  2)-2   
'    )1-2   
do  for   Step2.
ffp
fPfPp
fLlf
Si
i
=
∈
∈
回繰り返す．を NStep2 Step3.
}),(),(exp{
}),(exp{
}),(exp{
)(/)'(
'
'2
'
'2
'
'2
'
'2
∑∑
∑
∑
∈∈
∈
∈
−=
−
−
=
ii
i
i
Ni
i
Ni
ii
Ni
ii
Ni
i
flVffV
ffV
flV
fPfP
</p>
</body>
</slide>
<slide page="26">
<body>
<p>
知的画像処理（１１）26
⎩⎨
⎧
の推定による分割テクスチャパラメータ教師無し
が特定された分割テクスチャパラメータ教師有り
L
L
よって行われる
最小化にエネルギーの定式化とテクスチャ分割も事後
テクスチャ分割問題
クスチャのＭＡＰ分割階層的モデルを持つテ
を決定する。低次レベルで尤度
を決定し，デルの事前確率高次レベルでＭＲＦモ
)|(
)(
fd
f
P
P
</p>
</body>
</slide>
<slide page="27">
<body>
<p>
知的画像処理（１１）27
とすると，　持つサイトの集合を
を，ラベルに対し，ある分割　ラベル集合
尤度：
}|{)(
},,1{
)( IfSiS
IML
i
I =∈=
=
f
fL
は，尤度ポテンシャル関数 )( f|dU
数．対するポテンシャル関
に上ののラベルを持つはタイプただし， df|d cIV Ic )()(
∑ ∑∑
∈ ⊂∀∈
==
LI Sc
I
c
Cc
c
I
VVU
)(
)()()( )( f|df|df|d
持つ領域に分割．　テクスチャタイプを
の１つの集合は，各サイトをラベル　テクスチャ
事前確率
L
P
f
f :)(
</p>
</body>
</slide>
<slide page="28">
<body>
<p>
知的画像処理（１１）28
分割を得る．でと表され､
は、ギー以上より、事後エネル
MAP)(minarg
)(
* d|ff
d|f
U
U
f
=
⎪⎩
⎪⎨⎧−
∈=
=
=
それ以外
が同じとき全ての
ポテンシャルは，マルチサイトクリーク
は，クリークポテンシャルこのとき，単一サイト
されていると仮定．以下のようにモデル化
のパラメータによってのテクスチャが、タイプ
)(
)(
)(
2
)()(
1
)()()(
)(,
)(
)(
},,{
MLL
I
c
i
I
cI
II
III
cid
V
V
I
β
β
α
βαθ
f|d
f|d
L
∑ ++=
+=
I
II VVU
UUU
)}|()|({)(
)()()(
)(
2
)(
1 fdfdf
f|dfd|f
</p>
</body>
</slide>
<slide page="29">
<body>
<p>
知的画像処理（１１）29
主な参考文献
S.Z.Li, Markov Random Field Modeling in Computer Vision, Springer-Verlag,   
(1995)
田中和之，”確率モデルによる画像処理技術入門”，電子情報通信学会基礎・
境界ソサイエティ主催企画若手研究者学生向けに最新技術をわかりやすく
紹介する講演会「ベイズ統計と統計力学を用いた確率的情報処理技術(2001)   
</p>
</body>
</slide>
</presentation>
