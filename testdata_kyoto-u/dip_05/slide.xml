<presentation language="ja">
<slide page="1">
<body>
<p>
画像の復元
</p>
</body>
</slide>
<slide page="2">
<body>
<p>
画像復元の枠組み
• ３次元シーンを２次元画像に投影時，理想的なピンホールカ
メラを用いると仮定すると透視投影
• 実際の光学機器にはレンズや光学系の歪みなどがあり，観
測される画像fd(x, y)は，本来得られる筈であった画像f(x, y)
から劣化(degradation) している場合がある
</p>
</body>
</slide>
<slide page="3">
<body>
<p>
画像復元の枠組み
• 観測画像の画素値fd(x，y)は，本来得られる筈である理想
画像の画素値f(ξ，η)が何らかの形で劣化した結果であ
ると仮定
• このときf(ξ，η)がfd(x，y)へ劣化することを表現する関数
h(x，y，ξ，η)，それ以外の要因をn(x，y) とおけば，
と定式化
このとき4 変数関数h(x，y，ξ，η)は劣化関数と呼ばれる
ここではn(x,y)をノイズと呼ぶことにする
∫ ∫∞∞− ∞∞− += ),(),,,(),(),( yxnddyxhfyxfd ηξηξηξ
</p>
</body>
</slide>
<slide page="4">
<body>
<p>
劣化の種類
• 式fd(x，y)を解くのは困難であるが，以下ように仮定すると，解くことが可能
• 1番目の仮定
– 劣化関数が位置に不変である．
– 観測画像の点(x, y) に対して理想画像の１点(ξ，η) が１対１対応で影響を与
える
• ２番目の仮定
– 座標値の歪み
– 画素値の歪み（座標は歪んでいない）
</p>
</body>
</slide>
<slide page="5">
<body>
<p>
復元方法
• 復元方法として
–周波数領域での復元(図のA を通る方法)
–実空間での復元(図のB を通る方法)
</p>
</body>
</slide>
<slide page="6">
<body>
<p>
周波数領域での復元
• 劣化関数h(x,y,ξ，η)が位置に不変
– これは，任意の理想画像の点(ξ, η) が観測画像の点(x, y) に対して
与える影響が理想画像と観測画像の点の相対的位置関係(x-ξ, y-
η)だけに依存
– この制約により劣化関数は２変数関数h(x,y,ξ，η) で表現可能
• このとき、観測画像の生成式は
と表現可能。ここでf*hはたたみ込み(convolution)
</p>
</body>
</slide>
<slide page="7">
<body>
<p>
周波数領域での復元
• 式fd(x，y)をフーリエ変換すると
• 周波数領域で考えると画像復元は
なる を求めることと定式化することが可能
• これを解くには
– 逆フィルタ(inverse lter)
– ウィーナーフィルター(Wiener lter) 
の二つの方法が知られている．
ブロック図
</p>
</body>
</slide>
<slide page="8">
<body>
<p>
逆フィルタ
• ノイズ が無い場合
– このとき， であるならば，簡単に
• 一般には (kx，ky) = 0 となる点(kx，ky) が存在する．このとき
(kx,ky) = 0であるので0/0 となり値は定まらない．しかし = 
0 となる点がたかだか可算個であるならば，逆フーリエ変換の
ときの積分
に与える影響は小さいので無視することが出来る．
</p>
</body>
</slide>
<slide page="9">
<body>
<p>
手ぶれモデル
• 焦点距離fのカメラで光軸に垂直な平面状の対象物体を撮影
• この平面のピンホールからの距離をL とする．このとき時刻-
T/2からT/2までのシャッター開放（露光）時間中，手ぶれでカメ
ラがY 方向に速度-Ｖで動いていたとする．
• カメラを固定して考えれば，相対的に対象物体が速度V で移
動したことになり，画像座標上では対象物体がy方向に速度v
= fV/L で移動する．
– このとき，時刻0 で静止しているカメラが単位時間撮影した場合の理想
画像をf(x, y) とする．カメラの手ぶれにより劣化した画像は
</p>
</body>
</slide>
<slide page="10">
<body>
<p>
ここでvt = -ηとおけば、
ここで、δ(x)はデルタ関数である．また，rect(x) は
と定義．よって劣化関数は
</p>
</body>
</slide>
<slide page="11">
<body>
<p>
周波数領域では
vT = 40 とした場合の劣化をシミュレートした観測画像と逆フィルターによ
る復元例
</p>
</body>
</slide>
<slide page="12">
<body>
<p>
次にノイズnが存在するとする
のとき は有限の値を持つ可能性があるので， は発
散してしまう．
• そこで画像に関して次の仮定をおく．
– 理想画像はなめらか
– ノイズは小さい
• これらの仮定からある周波数Wに対して
– 低周波数の領域
• 滑らかな理想画像の影響がノイズより強く，上式の第１項が第２項より
大きい
– 高周波数の領域
• 理想画像の成分は減少しノイズと劣化関数の成分だけが残り，第２項が
大きくなり画像の復元に悪影響を与える
</p>
</body>
</slide>
<slide page="13">
<body>
<p>
• そこで，高周波数では，ノイズや劣化関数の影響を除
去して逆フィルタを次のように定義
• ここでは，高周波数領域ではノイズや劣化関数の影
響を無視して = 1 と近似
• 低周波数領域で が0 に近い場合はその点を無視
することにして計算
</p>
</body>
</slide>
<slide page="14">
<body>
<p>
• 理想画像をF(x, y)，観測画像をFd(x, y)，既知の劣化関数をH(x, y)，ノイズ
をN(x,y) とすると，離散的な場合も連続的な場合と全く同様に劣化過程は
と表現．離散フーリエ変換すれば
復元問題は
とおいて，復元画像Fe と理想画像Fの差のノルムの二乗 が
小さくなるような を見つけるという形で定式化可能
ウィーナーフィルター
</p>
</body>
</slide>
<slide page="15">
<body>
<p>
• 問題となるのは未知のノイズN が存在すること
• ウィーナーフィルター
– 同じ被写体を同じ条件で撮影し，多数の画像Fdの集合が与えられた
ものとして，その統計的性質から復元する手法
– すなわち，集合平均をＥ|・|とし，
が最小になるようにする．この問題はパーセバルの等式から
を最小化することと同値． から
ここで，＊は複素共役を表す。
</p>
</body>
</slide>
<slide page="16">
<body>
<p>
M を変化させたときの の最小値を求める．
このための必要条件は上式をM で偏微分すると0 になることである．
そこで で偏微分して0 とおくと
よって， を用いて
と の複素共役から
これと を に代入すれば
</p>
</body>
</slide>
<slide page="17">
<body>
<p>

</p>
</body>
</slide>
<slide page="18">
<body>
<p>
ノイズの無い場合
• 長時間露光シミュレーション
ノイズ画像 単純な逆変換
</p>
</body>
</slide>
<slide page="19">
<body>
<p>
ノイズの無い場合
• 焦点外れシミュレーション
ノイズ画像 単純な逆変換
</p>
</body>
</slide>
<slide page="20">
<body>
<p>
ノイズのある場合のフィルター
• y 方向にvT = 40 で手ぶれがあるときのシミュレーション画像
に対して，画像全体に一様乱数でノイズを付与した画像に対
する復元結果
</p>
</body>
</slide>
<slide page="21">
<body>
<p>
ノイズのある場合
• 長時間露光シミュレーション
ノイズ画像 単純な逆変換
ノイズ考慮 ウィーナー
</p>
</body>
</slide>
<slide page="22">
<body>
<p>
ノイズのある場合
• 焦点外れシミュレーション
ノイズ画像 単純な逆変換
ノイズ考慮 ウィーナー
</p>
</body>
</slide>
<slide page="23">
<body>
<p>
実空間での復元
• 観測画像の点(x，y) が(x’，y’) の点の間に連続かつ１対１な対応がある
とする．このとき点(x’，y’)は(x，y) の関数として
と表現
このとき
– 座標値の歪み
– 濃度の歪み
について，それぞれ
– 幾何学的復元(geometric correction)
– 濃淡補正
で求めることが可能．
</p>
</body>
</slide>
<slide page="24">
<body>
<p>
幾何学的復元
• 平面上の点(x’,y’) を(x, y) に移すことを（座標）変換(transformation) 
• 観測画像の点(x, y) が理想画像の点(x’, y’) と連続で１対１の変換
で表現。このとき式は，下記のように表現される
• この式はこのままでは解くことは困難
• そこで対応の連続性から画像の特徴的な点を基準点として見出し，その
点の観測画像と理想画像の点の間の変換式を決定
</p>
</body>
</slide>
<slide page="25">
<body>
<p>
幾何学的復元
具体的手順は
–変換モデルの選択
–基準点の選定
–補正式の決定
–再配列
–補間
</p>
</body>
</slide>
<slide page="26">
<body>
<p>
変換モデルの選択
• 座標変換の変換モデルを選択
– これによりモデルのパラメータを決定すれば，変換が一意
に定まる．
– 以下に変換モデルの例を示す．
– アフィン変換
• 変換モデルとしてもっとも簡単なのはアフィン変換(ane
transform) 
• a からf までの６つのパラメータで決定
</p>
</body>
</slide>
<slide page="27">
<body>
<p>
歪曲（ひずみ）
• ３次元シーンを撮影するときに、通常は，ピンホールの代わりにレンズを
用いたカメラが利用
– 理想画像との間にレンズが原因となるさまざまな歪みが表れる．
• 像の歪曲(distortion) 
– 理想画像の座標と観測画像の座標の間にずれが生じる
• 歪曲にはその光学的性質により
– 樽型ひずみ(barrel distortion) 
– 糸巻型ひずみ(pincussion distortion)
• 式で表現すると
</p>
</body>
</slide>
<slide page="28">
<body>
<p>
歪曲（ひずみ）
• 一般の場合
– x = hx(x’, y’), y = hy(x’, y’)が必要な階数だけ微分可能であ
るとするとM 階までマクローリン(Maclaurin) 展開すれば．
よってM 次までの近似を求めるのであれば，
とおいて，係数aij, bij を決定し変換式を決定する．アフィン
変換や歪曲も，この枠組みで表現可能
</p>
</body>
</slide>
<slide page="29">
<body>
<p>
基準点の選定
• 基準点は，
– 画像でその点が明確化できること
– 理想画像での座標がわかっていること
が重要
• 光学系の歪みはその構成や設定が同じならば一定と考える
• 基準点を人工的に事前に与えて変換式を求めることがある．
• 与えた基準点はGT(Ground Truth) と呼ばれる
</p>
</body>
</slide>
<slide page="30">
<body>
<p>
補正式の決定
• 基準点の理想画像と観測画像での座標値が厳密に与えら
れるのであれば．
– 補正式を特徴づける係数の数を決めるのに必要な数の基準点を求
めれば十分である．
• 方程式を解くために必要な数より多くの基準点を設け，最小
二乗法で係数を決定
• 逆に基準点の数が係数の数より少ない場合でも，何らかの
制約を設け，最適化問題として補正式を決定。
実際には誤差が存在
</p>
</body>
</slide>
<slide page="31">
<body>
<p>
再配列(resampling)
• 再配列
– 理想画像の画素を観測画像中に並べる処理
• 補正式が分かれば，その逆変換によって理想画像の各画素
の座標(i,  j)に対する観測画像での連続的な座標値(xi, yj)
が決定可能
</p>
</body>
</slide>
<slide page="32">
<body>
<p>
補間(interpolation)
• 再配列によって観測画像中に埋め込まれた理想画
像の画素の位置(xi，yj)での画素値f(xi，yj) を観測
画像での座標値f(m，n) での値をもとに決定
– 再近隣補間法(nearest neighbor interpolation)
– 共一次補間法(bi-linear interpolation)
– 3 次たたみ込み補間法(cubic convolution 
interpolation)
</p>
</body>
</slide>
<slide page="33">
<body>
<p>
再近隣補間法
• 点(xi, yj ) の画素値を，最も近い観測画像
での座標点([xi +0.5], [yi +0.5]) の値とす
る．
• 得られた画素値をそのまま使うのでデータ
内容が壊されない利点があるが座標値は
通常一致しない
(xi ，yi) ≠ ([xi + 0.5], [yj + 0.5])
</p>
</body>
</slide>
<slide page="34">
<body>
<p>
共一次補間法
(xi, yi) に近傍の4 点の格子点からの線形近似
</p>
</body>
</slide>
<slide page="35">
<body>
<p>
3 次たたみ込み補間法
• サンプリング定理によれば，高周波数成分を持たな
ければ離散的な観測値をもとに
• として再現できる．Wx = Wy = πであるならば
• ここではsinc(α) = sin(πα)/(πα) で定義
</p>
</body>
</slide>
<slide page="36">
<body>
<p>
3 次たたみ込み補間法
• 式は画像の格子上の画素値で画像全体の連続的な画素値
を決定できることを意味
– 実際に計算できない
• ｓinc 関数が原点から離れるほど値が小さくなる性質を利用
して，再現しようとする画素値の近くの格子点の画素値のみ
を用いて近似
</p>
</body>
</slide>
<slide page="37">
<body>
<p>
3 次たたみ込み補間法
• 実際にはsinc関数はxの除算があり計算が
不安定になり易い
• 以下のような近似式を用いることが多い．
</p>
</body>
</slide>
<slide page="38">
<body>
<p>
濃淡補正
• カメラでは中心部から離れるほど光の入射量が減
る
– 得られる画像は周辺部が暗くなる．
– 観測画像の画素値はそれぞれの点ごとにある比率で画
素値が変化
– この変化の比率の逆数
• 画像位置の関数としてh(x,y)で表現すると、
• 照明条件（露光）が均一となるよう環境を整え、そこに一様な被写
体をおいて撮影することで
</p>
</body>
</slide>
<slide page="39">
<body>
<p>
• 同じ光学系の条件で撮影した画像の画素値が
fd(x，y)であるとき，
となり補正可能
濃淡補正
</p>
</body>
</slide>
</presentation>
